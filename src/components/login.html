<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta content="telephone=no" name="format-detection">
    <title>登录</title>
    <style>
      @font-face {
        font-family: 'iconfont';  /* project id 211629 */
        src: url('http://at.alicdn.com/t/font_vxu5hysaq4asv2t9.eot');
        src: url('http://at.alicdn.com/t/font_vxu5hysaq4asv2t9.eot?#iefix') format('embedded-opentype'),
        url('http://at.alicdn.com/t/font_vxu5hysaq4asv2t9.woff') format('woff'),
        url('http://at.alicdn.com/t/font_vxu5hysaq4asv2t9.ttf') format('truetype'),
        url('http://at.alicdn.com/t/font_vxu5hysaq4asv2t9.svg#iconfont') format('svg');
      }
      *{box-sizing:border-box}html,body{height:100%}body{font-family:"Helvetica","Tahoma","Arial","Hiragino Sans GB","冬青黑体","Microsoft YaHei","微软雅黑","STXihei","华文细黑","SimSun","宋体","Heiti","黑体","sans-serif";overflow:hidden;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.login input,.login button{padding:0;border:0;margin:0;outline:0}.login{position:absolute;top:0;left:0;z-index:9999;width:100%;height:100%;padding:94px 60px 0 60px;background-color:#fff}hgroup{margin-bottom:35px}hgroup h3{text-align:center;font-size:22px;font-weight:normal;color:#1c9efe}form>p{position:relative;height:40px;margin-bottom:30px}form #pwArea{margin-bottom:10px}.loginFail{color:red;visibility:hidden}form>p:after{content:'';width:100%;height:1px;display:block;background:#ccc;position:absolute;transform:scaleY(0.5);left:0;bottom:0}form>.active:after{background:#389bff}form>p:first-child .remove{right:0}form>p>span{position:absolute;top:0;left:0;z-index:1;font-size:14px;line-height:40px;color:#333;user-select:none}.login input{position:absolute;top:0;left:0;width:100%;height:40px;font-size:14px;padding-left:48px;padding-right:34px}.login form .icon{position:absolute;top:0;font-family:iconfont;padding:0 10px;line-height:40px;user-select:none;color:#bcbcbc}form>p .pw{padding-right:68px}form>p .remove{right:34px}form>p .hide,form>p .show{right:0}form .hide:after{content:'\e640'}form .show:after{content:'\e679';color:#1c9efe}.login .remove{font:14px iconfont}.login .btn-login{width:100%;height:36px;font-size:16px;line-height:36px;text-align:center;color:#7dbeff;background-color:#389bff;border-radius:4px}.login .btn-login.active{color:#fff}.errorShow{position:absolute;top:0;right:0;bottom:0;left:0;z-index:99999;display:none;-webkit-box-pack:justify;-ms-flex-pack:justify;flex:0 1 100%;flex-direction:column;justify-content:center;align-content:center;background-color:#fff}.errorShow img{display:block;margin:0 auto 20px}.errorShow span{text-align:center}#delName,#delPw,#toggleStatu{visibility:hidden}
    </style>
  </head>
  <body>
    <div class="login">
      <hgroup>
        <h3>上海新华传媒数据</h3>
        <h3>分析平台</h3>
      </hgroup>
      <form>
        <p id="nameArea">
          <span>账号</span>
          <input class="name" type="text" placeholder="请输入账号" />
          <i id="delName" class="icon remove">&#xe616;</i>
        </p>
        <p id="pwArea">
          <span>密码</span>
          <input class="pw" type="password" placeholder="请输入密码" />
          <i id="delPw" class="icon remove">&#xe616;</i>
          <i id="toggleStatu" class="icon hide"></i>
        </p>
      </form>
      <div class="loginFail">用户名或密码有误！</div>
      <button class="btn-login">登录</button>
    </div>
    <div class="errorShow">
      <img src="http://dtimg.aoshidata.com/shxhWx/dataError.png" alt="">
      <span>数据请求失败，请重新刷新页面</span>
    </div>
    <script src="https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
    <script>
      !function(){"use strict";function t(t){if(t)c[0]=c[16]=c[1]=c[2]=c[3]=c[4]=c[5]=c[6]=c[7]=c[8]=c[9]=c[10]=c[11]=c[12]=c[13]=c[14]=c[15]=0,this.blocks=c,this.buffer8=i;else if(n){var r=new ArrayBuffer(68);this.buffer8=new Uint8Array(r),this.blocks=new Uint32Array(r)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=0,this.finalized=this.hashed=!1,this.first=!0}var r="object"==typeof window?window:{},e=!r.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;e&&(r=global);var i,h=!r.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,s="function"==typeof define&&define.amd,n=!r.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,f="0123456789abcdef".split(""),o=[128,32768,8388608,-2147483648],a=[0,8,16,24],u=["hex","array","digest","buffer","arrayBuffer"],c=[];if(n){var p=new ArrayBuffer(68);i=new Uint8Array(p),c=new Uint32Array(p)}var d=function(r){return function(e){return new t(!0).update(e)[r]()}},y=function(){var r=d("hex");e&&(r=l(r)),r.create=function(){return new t},r.update=function(t){return r.create().update(t)};for(var i=0;i<u.length;++i){var h=u[i];r[h]=d(h)}return r},l=function(t){var r=require("crypto"),e=require("buffer").Buffer,i=function(i){if("string"==typeof i)return r.createHash("md5").update(i,"utf8").digest("hex");if(i.constructor===ArrayBuffer)i=new Uint8Array(i);else if(void 0===i.length)return t(i);return r.createHash("md5").update(new e(i)).digest("hex")};return i};t.prototype.update=function(t){if(!this.finalized){var e="string"!=typeof t;e&&t.constructor==r.ArrayBuffer&&(t=new Uint8Array(t));for(var i,h,s=0,f=t.length||0,o=this.blocks,u=this.buffer8;f>s;){if(this.hashed&&(this.hashed=!1,o[0]=o[16],o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),e)if(n)for(h=this.start;f>s&&64>h;++s)u[h++]=t[s];else for(h=this.start;f>s&&64>h;++s)o[h>>2]|=t[s]<<a[3&h++];else if(n)for(h=this.start;f>s&&64>h;++s)i=t.charCodeAt(s),128>i?u[h++]=i:2048>i?(u[h++]=192|i>>6,u[h++]=128|63&i):55296>i||i>=57344?(u[h++]=224|i>>12,u[h++]=128|i>>6&63,u[h++]=128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++s)),u[h++]=240|i>>18,u[h++]=128|i>>12&63,u[h++]=128|i>>6&63,u[h++]=128|63&i);else for(h=this.start;f>s&&64>h;++s)i=t.charCodeAt(s),128>i?o[h>>2]|=i<<a[3&h++]:2048>i?(o[h>>2]|=(192|i>>6)<<a[3&h++],o[h>>2]|=(128|63&i)<<a[3&h++]):55296>i||i>=57344?(o[h>>2]|=(224|i>>12)<<a[3&h++],o[h>>2]|=(128|i>>6&63)<<a[3&h++],o[h>>2]|=(128|63&i)<<a[3&h++]):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++s)),o[h>>2]|=(240|i>>18)<<a[3&h++],o[h>>2]|=(128|i>>12&63)<<a[3&h++],o[h>>2]|=(128|i>>6&63)<<a[3&h++],o[h>>2]|=(128|63&i)<<a[3&h++]);this.lastByteIndex=h,this.bytes+=h-this.start,h>=64?(this.start=h-64,this.hash(),this.hashed=!0):this.start=h}return this}},t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,r=this.lastByteIndex;t[r>>2]|=o[3&r],r>=56&&(this.hashed||this.hash(),t[0]=t[16],t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.bytes<<3,this.hash()}},t.prototype.hash=function(){var t,r,e,i,h,s,n=this.blocks;this.first?(t=n[0]-680876937,t=(t<<7|t>>>25)-271733879<<0,i=(-1732584194^2004318071&t)+n[1]-117830708,i=(i<<12|i>>>20)+t<<0,e=(-271733879^i&(-271733879^t))+n[2]-1126478375,e=(e<<17|e>>>15)+i<<0,r=(t^e&(i^t))+n[3]-1316259209,r=(r<<22|r>>>10)+e<<0):(t=this.h0,r=this.h1,e=this.h2,i=this.h3,t+=(i^r&(e^i))+n[0]-680876936,t=(t<<7|t>>>25)+r<<0,i+=(e^t&(r^e))+n[1]-389564586,i=(i<<12|i>>>20)+t<<0,e+=(r^i&(t^r))+n[2]+606105819,e=(e<<17|e>>>15)+i<<0,r+=(t^e&(i^t))+n[3]-1044525330,r=(r<<22|r>>>10)+e<<0),t+=(i^r&(e^i))+n[4]-176418897,t=(t<<7|t>>>25)+r<<0,i+=(e^t&(r^e))+n[5]+1200080426,i=(i<<12|i>>>20)+t<<0,e+=(r^i&(t^r))+n[6]-1473231341,e=(e<<17|e>>>15)+i<<0,r+=(t^e&(i^t))+n[7]-45705983,r=(r<<22|r>>>10)+e<<0,t+=(i^r&(e^i))+n[8]+1770035416,t=(t<<7|t>>>25)+r<<0,i+=(e^t&(r^e))+n[9]-1958414417,i=(i<<12|i>>>20)+t<<0,e+=(r^i&(t^r))+n[10]-42063,e=(e<<17|e>>>15)+i<<0,r+=(t^e&(i^t))+n[11]-1990404162,r=(r<<22|r>>>10)+e<<0,t+=(i^r&(e^i))+n[12]+1804603682,t=(t<<7|t>>>25)+r<<0,i+=(e^t&(r^e))+n[13]-40341101,i=(i<<12|i>>>20)+t<<0,e+=(r^i&(t^r))+n[14]-1502002290,e=(e<<17|e>>>15)+i<<0,r+=(t^e&(i^t))+n[15]+1236535329,r=(r<<22|r>>>10)+e<<0,t+=(e^i&(r^e))+n[1]-165796510,t=(t<<5|t>>>27)+r<<0,i+=(r^e&(t^r))+n[6]-1069501632,i=(i<<9|i>>>23)+t<<0,e+=(t^r&(i^t))+n[11]+643717713,e=(e<<14|e>>>18)+i<<0,r+=(i^t&(e^i))+n[0]-373897302,r=(r<<20|r>>>12)+e<<0,t+=(e^i&(r^e))+n[5]-701558691,t=(t<<5|t>>>27)+r<<0,i+=(r^e&(t^r))+n[10]+38016083,i=(i<<9|i>>>23)+t<<0,e+=(t^r&(i^t))+n[15]-660478335,e=(e<<14|e>>>18)+i<<0,r+=(i^t&(e^i))+n[4]-405537848,r=(r<<20|r>>>12)+e<<0,t+=(e^i&(r^e))+n[9]+568446438,t=(t<<5|t>>>27)+r<<0,i+=(r^e&(t^r))+n[14]-1019803690,i=(i<<9|i>>>23)+t<<0,e+=(t^r&(i^t))+n[3]-187363961,e=(e<<14|e>>>18)+i<<0,r+=(i^t&(e^i))+n[8]+1163531501,r=(r<<20|r>>>12)+e<<0,t+=(e^i&(r^e))+n[13]-1444681467,t=(t<<5|t>>>27)+r<<0,i+=(r^e&(t^r))+n[2]-51403784,i=(i<<9|i>>>23)+t<<0,e+=(t^r&(i^t))+n[7]+1735328473,e=(e<<14|e>>>18)+i<<0,r+=(i^t&(e^i))+n[12]-1926607734,r=(r<<20|r>>>12)+e<<0,h=r^e,t+=(h^i)+n[5]-378558,t=(t<<4|t>>>28)+r<<0,i+=(h^t)+n[8]-2022574463,i=(i<<11|i>>>21)+t<<0,s=i^t,e+=(s^r)+n[11]+1839030562,e=(e<<16|e>>>16)+i<<0,r+=(s^e)+n[14]-35309556,r=(r<<23|r>>>9)+e<<0,h=r^e,t+=(h^i)+n[1]-1530992060,t=(t<<4|t>>>28)+r<<0,i+=(h^t)+n[4]+1272893353,i=(i<<11|i>>>21)+t<<0,s=i^t,e+=(s^r)+n[7]-155497632,e=(e<<16|e>>>16)+i<<0,r+=(s^e)+n[10]-1094730640,r=(r<<23|r>>>9)+e<<0,h=r^e,t+=(h^i)+n[13]+681279174,t=(t<<4|t>>>28)+r<<0,i+=(h^t)+n[0]-358537222,i=(i<<11|i>>>21)+t<<0,s=i^t,e+=(s^r)+n[3]-722521979,e=(e<<16|e>>>16)+i<<0,r+=(s^e)+n[6]+76029189,r=(r<<23|r>>>9)+e<<0,h=r^e,t+=(h^i)+n[9]-640364487,t=(t<<4|t>>>28)+r<<0,i+=(h^t)+n[12]-421815835,i=(i<<11|i>>>21)+t<<0,s=i^t,e+=(s^r)+n[15]+530742520,e=(e<<16|e>>>16)+i<<0,r+=(s^e)+n[2]-995338651,r=(r<<23|r>>>9)+e<<0,t+=(e^(r|~i))+n[0]-198630844,t=(t<<6|t>>>26)+r<<0,i+=(r^(t|~e))+n[7]+1126891415,i=(i<<10|i>>>22)+t<<0,e+=(t^(i|~r))+n[14]-1416354905,e=(e<<15|e>>>17)+i<<0,r+=(i^(e|~t))+n[5]-57434055,r=(r<<21|r>>>11)+e<<0,t+=(e^(r|~i))+n[12]+1700485571,t=(t<<6|t>>>26)+r<<0,i+=(r^(t|~e))+n[3]-1894986606,i=(i<<10|i>>>22)+t<<0,e+=(t^(i|~r))+n[10]-1051523,e=(e<<15|e>>>17)+i<<0,r+=(i^(e|~t))+n[1]-2054922799,r=(r<<21|r>>>11)+e<<0,t+=(e^(r|~i))+n[8]+1873313359,t=(t<<6|t>>>26)+r<<0,i+=(r^(t|~e))+n[15]-30611744,i=(i<<10|i>>>22)+t<<0,e+=(t^(i|~r))+n[6]-1560198380,e=(e<<15|e>>>17)+i<<0,r+=(i^(e|~t))+n[13]+1309151649,r=(r<<21|r>>>11)+e<<0,t+=(e^(r|~i))+n[4]-145523070,t=(t<<6|t>>>26)+r<<0,i+=(r^(t|~e))+n[11]-1120210379,i=(i<<10|i>>>22)+t<<0,e+=(t^(i|~r))+n[2]+718787259,e=(e<<15|e>>>17)+i<<0,r+=(i^(e|~t))+n[9]-343485551,r=(r<<21|r>>>11)+e<<0,this.first?(this.h0=t+1732584193<<0,this.h1=r-271733879<<0,this.h2=e-1732584194<<0,this.h3=i+271733878<<0,this.first=!1):(this.h0=this.h0+t<<0,this.h1=this.h1+r<<0,this.h2=this.h2+e<<0,this.h3=this.h3+i<<0)},t.prototype.hex=function(){this.finalize();var t=this.h0,r=this.h1,e=this.h2,i=this.h3;return f[t>>4&15]+f[15&t]+f[t>>12&15]+f[t>>8&15]+f[t>>20&15]+f[t>>16&15]+f[t>>28&15]+f[t>>24&15]+f[r>>4&15]+f[15&r]+f[r>>12&15]+f[r>>8&15]+f[r>>20&15]+f[r>>16&15]+f[r>>28&15]+f[r>>24&15]+f[e>>4&15]+f[15&e]+f[e>>12&15]+f[e>>8&15]+f[e>>20&15]+f[e>>16&15]+f[e>>28&15]+f[e>>24&15]+f[i>>4&15]+f[15&i]+f[i>>12&15]+f[i>>8&15]+f[i>>20&15]+f[i>>16&15]+f[i>>28&15]+f[i>>24&15]},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var t=this.h0,r=this.h1,e=this.h2,i=this.h3;return[255&t,t>>8&255,t>>16&255,t>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&e,e>>8&255,e>>16&255,e>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255]},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(16),r=new Uint32Array(t);return r[0]=this.h0,r[1]=this.h1,r[2]=this.h2,r[3]=this.h3,t},t.prototype.buffer=t.prototype.arrayBuffer;var b=y();h?module.exports=b:(r.md5=b,s&&define(function(){return b}))}();
    </script>
    <script>
    (function () {

      var wxVal = '';
      var idVal = '';
      var search = window.location.search;
      var demo = GetQueryString('demo');
      var userId = window.localStorage.getItem('userId');

      if (parseInt(userId)) {
        if (demo === '0') {
          window.location.href = 'http://qianduan.cnonixdata.com/shxhDemo';
        } else if (demo === '1') {
          window.location.href = 'http://qianduan.cnonixdata.com/wei_contrast';
        }
        return;
      }

      var name = $('.name');
      var delName = $('#delName');
      var pw = $('.pw');
      var delPw = $('#delPw');
      var btnToggle = $('#toggleStatu');
      var btnLogin = $('.btn-login');
      var errorTxt = $('.errorShow');
      var nameArea = $('#nameArea');
      var pwArea = $('#pwArea');

      // 设置userId
      (function () {
        var code = GetQueryString('code');
        var state = GetQueryString('state');
        var urlApi = 'http://shda.bookmall.com.cn/App/AppWeiXin/AppOpenIdSupply'

        var postProps = {
          'Code': code,
          'State': state
        };

        //  md5加密
        var md5Obj = setMd5(postProps)
        var sign = md5Obj.sign
        var obj = md5Obj.obj

        $.ajax({
          type: 'POST',
          url: urlApi + '?appkey=123&sign=' + sign,
          data: obj,
          async: false,
          success: function (data) {
            var dataObj = JSON.parse(data);
            wxVal = dataObj.OpenId;
            idVal = dataObj.UserId;
            if (idVal !== '0' && idVal !== undefined) {
              window.localStorage.setItem('userId', idVal);
            } 
          },
          error: function (xhr, type) {
            errorTxt.attr({
              'display': '-webkit-box',
              'display': '-webkit-flex',
              'display': '-ms-flexbox',
              'display': 'flex' 
            });
          }
        })
      })();

      name.on('input', function () {
        var value = $(this).val();
        if (value) {
          delName.css('visibility', 'visible');
          pw.val() && btnLogin.addClass('active');
        } else {
          delName.css('visibility', 'hidden');
          btnLogin.removeClass('active');
        }
      }).on('focus', function () {
          nameArea.addClass('active');
      }).on('blur', function () {
          nameArea.removeClass('active');
      });

      pw.on('input', function () {
        var value = $(this).val();
        if (value) {
          delPw.css('visibility', 'visible');
          btnToggle.css('visibility', 'visible');
          name.val() && btnLogin.addClass('active');
        } else {
          delPw.css('visibility', 'hidden');
          btnToggle.css('visibility', 'hidden');
          btnLogin.removeClass('active');
        }
      }).on('focus', function () {
          pwArea.addClass('active');
      }).on('blur', function () {
          pwArea.removeClass('active');
      });

      delName.on('click', function () {
        name.val('');
        delName.css('visibility', 'hidden');
        btnLogin.removeClass('active');
      });

      delPw.on('click', function () {
        pw.val('');
        delPw.css('visibility', 'hidden');
        btnToggle.css('visibility', 'hidden');
        btnLogin.removeClass('active');
      });

      btnToggle.on('click', function () {
        var classTxt = this.classList.value
        if (/hide/.test(classTxt)) {
          pw.attr('type', 'text');
          this.classList.value = 'icon show';
        } else {
          pw.attr('type', 'password');
          this.classList.value = 'icon hide';
        }
      });

      btnLogin.on('click', function () {
        var account = name.val();
        var pw_txt = pw.val();

        var postProps = {
          'OpenId': wxVal,
          'UserName': account,
          'PassWord': pw_txt
        };

        //  md5加密
        var md5Obj = setMd5(postProps);
        var sign = md5Obj.sign;
        var obj = md5Obj.obj;
        var urlApi = 'http://shda.bookmall.com.cn/App/AppWeiXin/AppLoginSupply';

        $.ajax({
          type: 'POST',
          url: `${urlApi}?appkey=123&sign=${sign}`,
          data: obj,
          async: false,
          success: function (data) {
            var dataObj = JSON.parse(data);
            var state = dataObj.state;
            if (state && demo === '0') {
              window.location.href = 'http://qianduan.cnonixdata.com/shxhDemo';
            } else if (state && demo === '1') {
              window.location.href = 'http://qianduan.cnonixdata.com/wei_contrast';
            } else {
              // 登录失败提示
              $('.loginFail').attr('visibility', 'visible');
            }
          },
          error: function (xhr, type) {
            errorTxt.attr({
              'display': '-webkit-box',
              'display': '-webkit-flex',
              'display': '-ms-flexbox',
              'display': 'flex'
            });
          }
        })

      })

      function GetQueryString (name) {
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = search.slice(1).match(reg);
        if (r != null) return  unescape(r[2]); 
        return null;
      }

      function setMd5 (dataObj) {
        /*----- 对象排序start -----*/
        var arr, obj;
        arr = [];
        obj = {};
        for (var key in dataObj) {
          arr.push(key);
        }
        arr.sort();
        for (var i = 0; i < arr.length; i++) {
          obj[arr[i]] = dataObj[arr[i]];
        }
        /*----- 对象排序end -----*/

        // md5加密
        var key = '04165ba7c66aertvk';
        var sign = md5(JSON.stringify(obj) + '|' + key).toUpperCase()

        return {
          obj: obj,
          sign: sign
        }
      }

    })();

    </script>
  </body>
</html>